<?xml version="1.0" encoding="UTF-8"?>
<beans>
  <bean id="dialListener" class="EventHandlers\DialListener" scope="singleton" listens-on="dialBegin, dialEnd, hangup, varSet">
    <property name="hangupStatement"><ref bean="hangupStatement"/></property>
    <property name="dialedTimeStatement"><ref bean="dialedTimeStatement"/></property>
    <property name="answeredTimeStatement"><ref bean="answeredTimeStatement"/></property>
    <property name="startCallStatement"><ref bean="startCallStatement"/></property>
    <property name="endCallStatement"><ref bean="endCallStatement"/></property>
  </bean>

  <bean id="hangupStatement" class="PDOStatement" scope="prototype" factory-bean="pdoMysql" factory-method="prepare">
    <constructor-arg><value>
UPDATE `${mysql.table}` SET `cause`=:cause,`cause_txt`=:causeTxt WHERE `uniqueid_src`=:uniqueidSrc
    </value></constructor-arg>
  </bean>

  <bean id="startCallStatement" class="PDOStatement" scope="prototype" factory-bean="pdoMysql" factory-method="prepare">
    <constructor-arg><value>
INSERT INTO `${mysql.table}` (
`dialstring`, `clid_name`, `clid_num`, `channel_src`, `channel_dst`,
`eventStart`, `uniqueid_src`, `uniqueid_dst`
) VALUES(
:dialString, :clidName, :clidNum, :channelSrc, :channelDst,
:eventStart, :uniqueidSrc, :uniqueidDst
)
    </value></constructor-arg>
  </bean>

  <bean id="dialedTimeStatement" class="PDOStatement" scope="prototype" factory-bean="pdoMysql" factory-method="prepare">
    <constructor-arg><value>
UPDATE `${mysql.table}` SET `time_dial`=:timeDial WHERE `uniqueid_src`=:uniqueidSrc
    </value></constructor-arg>
  </bean>

  <bean id="answeredTimeStatement" class="PDOStatement" scope="prototype" factory-bean="pdoMysql" factory-method="prepare">
    <constructor-arg><value>
UPDATE `${mysql.table}` SET `time_answer`=:timeAnswer WHERE `uniqueid_src`=:uniqueidSrc
    </value></constructor-arg>
  </bean>

  <bean id="endCallStatement" class="PDOStatement" scope="prototype" factory-bean="pdoMysql" factory-method="prepare">
    <constructor-arg><value>
UPDATE `${mysql.table}` SET `eventEnd`=:eventEnd, `status`=:status WHERE `uniqueid_src`=:uniqueidSrc
    </value></constructor-arg>
  </bean>

  <bean id="pdoMysql" class="PDO" scope="singleton">
    <constructor-arg><value>mysql:dbname=${mysql.db};host=${mysql.host};port=${mysql.port}</value></constructor-arg>
    <constructor-arg><value>${mysql.username}</value></constructor-arg>
    <constructor-arg><value>${mysql.password}</value></constructor-arg>
  </bean>
</beans>
