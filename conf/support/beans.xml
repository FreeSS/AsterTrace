<?xml version="1.0" encoding="UTF-8"?>
<beans>
  <import resource="error-handler.xml"/>
  <import resource="shutdown-handler.xml"/>
  <import resource="signal-handler.xml"/>
  <bean id="PropertiesHolder" class="Ding\Helpers\Properties\PropertiesHelper" scope="singleton">  
    <property name="locations">  
      <array>  
        <entry key="0"><value>file://${config.dir}/ramid.properties</value></entry>  
        <entry key="1"><value>file://${config.dir}/php.properties</value></entry>  
        <entry key="1"><value>file://${config.dir}/mysql.properties</value></entry>  
      </array>  
    </property>  
  </bean>
  <bean id="pami" class="Ding\Helpers\PAMI\PamiHelper" scope="singleton" init-method="open" destroy-method="close" depends-on="myCallListener">
    <property name="username"><value>${ami.username}</value></property>
    <property name="password"><value>${ami.password}</value></property>
    <property name="host"><value>${ami.host}</value></property>
    <property name="port"><value>${ami.port}</value></property>
    <property name="handler"><ref bean="myPamiHandler"/></property>
  </bean>
  <bean id="myPamiHandler" class="MyPamiHandler" scope="singleton"/>
  <bean id="insertCallStatement" class="PDOStatement" scope="prototype" factory-bean="pdoMysql" factory-method="prepare">
    <constructor-arg><value>INSERT INTO `${mysql.table}` (`call`) VALUES(:call)</value></constructor-arg>
  </bean>
  <bean id="pdoMysql" class="PDO" scope="singleton">
    <constructor-arg><value>mysql:dbname=${mysql.db};host=${mysql.host};port=${mysql.port}</value></constructor-arg>
    <constructor-arg><value>${mysql.username}</value></constructor-arg>
    <constructor-arg><value>${mysql.password}</value></constructor-arg>
  </bean>
  <bean id="myCallListener" class="MyCallListener" scope="singleton" listens-on="dial">
    <property name="insertStatement"><ref bean="insertCallStatement"/></property>
  </bean>
</beans>
